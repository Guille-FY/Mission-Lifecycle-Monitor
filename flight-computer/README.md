# Flight Computer (Backend)

The **Flight Computer** acts as the On-Board Computer (OBC) for the mission. It is a Node.js application that runs the physics simulation loop, manages the mission state machine, and generates real-time telemetry.

## ðŸ› ï¸ Architecture

*   **Tech**: Node.js, Express.js.
*   **Role**: Runs the physics simulation loop (gravity turn, orbital mechanics) and state machine.
*   **Instrumentation**: **OpenTelemetry (Node.js SDK)** generates traces, metrics, and logs for every operation.

## ðŸ“œ Flight Sequence & Events

The Flight Computer simulates a realistic launch timeline with specific events based on altitude and speed thresholds:

1.  **Start Sequence**: Countdown from T-10, Internal Guidance transition, Main Engine Start.
2.  **Ignition & Liftoff**: Launch detection and tower clearance.
3.  **Gravity Turn (T+ ~10s)**: Rocket begins pitching over to gain horizontal velocity.
4.  **Mach 1 (Sound Barrier)**: Vehicle transitions to supersonic flight (~1234 km/h).
5.  **Max Q (11 km)**: Maximum Dynamic Pressure region, where structural stress is highest.
6.  **Telemetry Handover (50 km)**: Comm link transitions from ground stations to TDRS satellite network.
7.  **MECO (Main Engine Cut-off) (75 km)**: First stage engine shutdown.
8.  **Stage Separation**: Separation of first stage and ignition of the second stage vacuum engine.
9.  **Fairing Separation (110 km)**: Protective nose cone deploy.
10. **Orbit Insertion (170 km)**: Target altitude reached, SECO (Second Engine Cut-off), and Systems Nominal.

## âš ï¸ Failure Scenarios

This is not just a "happy path" demo. The system includes a **probabilistic failure engine** to demonstrate anomaly detection:

*   **Pad Abort (Start)**: 5% chance of Combustion Instability during the first 4 seconds of flight.
*   **Ascent Failures**: ~30% cumulative probability of critical failure during ascent (Turbopump Overheat or Hydraulic Pressure Loss).
*   **Manual Abort**: The user can trigger an emergency abort at any time, which logs a specific `WARNING` event.

## ðŸ“‹ Event Catalog

Below is the complete reference of all events generated by the simulation:

| Event Message | Type | Trigger Condition |
| :--- | :---: | :--- |
| **Pre-Launch & Launch** | | |
| `System Reset` | `INFO` | Manual click on "Reset" button. |
| `T-Minus 1 minute` | `INFO` | Countdown reaches 60s. |
| `Guidance is internal` | `INFO` | Countdown reaches 10s. |
| `Main Engine Start Sequence` | `INFO` | Countdown reaches 6s. |
| `IGNITION! LIFTOFF! We have a liftoff.` | `SUCCESS` | Countdown reaches 0s. |
| `Tower cleared` | `INFO` | Immediately after liftoff. |
| **Ascent Phase** | | |
| `Gravity Turn Maneuver Started` | `INFO` | Altitude > 1,000 m. |
| `Vehicle is Supersonic (Mach 1)` | `INFO` | Speed > 1,234 km/h. |
| `MAX Q reached (Maximum Dynamic Pressure)` | `INFO` | Altitude > 11,000 m. |
| `Telemetry Handover to Data Relay Satellites`| `INFO` | Altitude > 50,000 m. |
| `MECO (Main Engine Cutoff) Confirmed` | `INFO` | Altitude > 75,000 m. |
| `Stage 1 Separation Confirmed` | `SUCCESS` | 2 seconds after MECO. |
| `Stage 2 Engine Ignition` | `INFO` | Immediately after Stage Separation. |
| `Fairing Separation Confirmed` | `SUCCESS` | Altitude > 110,000 m. |
| `Orbit Insertion Complete` | `SUCCESS` | Altitude reaches 170 km (Target Orbit). |
| `SECO (Second Engine Cutoff)` | `INFO` | Upon Orbit Insertion. |
| `Systems Nominal` | `SUCCESS` | Upon Orbit Insertion. |
| **Anomalies & Failures** | | |
| `Telemetry Check: Signal Nominal` | `INFO` | Random operational "heartbeat" (1% chance/tick). |
| `PROPELLANT DEPLETED BEFORE ORBIT...` | `WARNING` | Fuel reaches 0% before Orbit Insertion. |
| `CRITICAL: Combustion Instability Detected` | `ERROR` | Random failure (5% chance) during T+0 to T+4s. |
| `AUTOMATIC PAD ABORT TRIGGERED` | `ERROR` | triggered by Combustion Instability. |
| `CRITICAL: Turbopump Exhaust Temp High` | `ERROR` | Random failure (~0.15%/tick) during ascent. |
| `CRITICAL: Hydraulic Pressure Loss...` | `ERROR` | Random failure (~0.15%/tick) during ascent. |
| `AUTOMATIC ABORT SEQUENCE INITIATED` | `ERROR` | Triggered by any ascent failure. |
| `MANUAL ABORT COMMAND RECEIVED` | `WARNING` | User clicks "Abort" button. |

## ðŸš€ Manual Startup

If you prefer to run the backend manually without Docker Compose:

```bash
# From the project root
npm install

# Run with OTel instrumentation
node --require ./flight-computer/instrumentation.js flight-computer/app.js
```
*The server runs on port `8080`.*
